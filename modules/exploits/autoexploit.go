package exploits

import (
	"fmt"
	"math/rand"
	"time"
	"uscan/modules/exploits/apache"

	"github.com/fatih/color"
)

// Handles autoexploiting process, exploiting modules Etc...

func StartingProcess(url string) {

	// Creates a seed to randomly pick a useragent
	userAgents := []string{"Mozilla/5.0 (Uscan NT 10.0; Win32; x86) AppleWebKit/537.36 (KHTML, like Gecko) Uscan/103.0.5060.114 Safari/537.36 RuxitSynthetic/1.0 v7906579803090315228 t1674167162172073183 ath1fb31b7a altpriv cvcv=2 cexpw=1 smf=0",
		"Mozilla/5.0 (Uscan; Android 10; VOG-L29) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4599.1 Mobile Safari/537.36",
		"Mozilla/5.0 (Uscan; U; Android 11; en-us; RMX2042 Build/RP1A.200720.011) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.116 Mobile Safari/537.36 HeyTapBrowser/45.8.0.1",
		"Mozilla/5.0 (Uscan; Android 8.0.0; LG-H871S Build/OPR1.170623.032; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/94.0.4606.85 Mobile Safari/537.36 [FB_IAB/FB4A;FBAV/341.0.0.30.73;"}

	rand.Seed(time.Now().Unix())

	// Loop till jobs end
	for {
		randomUseragent := userAgents[rand.Intn(len(userAgents))]
		if !DetectWordpress(url, randomUseragent) {
			cmsnotfound("Wordpress ")
		}
		apache.CVE_41773(url, randomUseragent)
		// Broken apache.CVE_42013(url, randomUseragent)
		apache.CVE_5638(url, randomUseragent)
		apache.CVE_9805(url, randomUseragent)

		break
	}
}

func cmsnotfound(msg string) {
	fmt.Println(msg + color.CyanString(">> ") + color.RedString("not found"))
}
